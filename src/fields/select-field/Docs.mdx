import { Meta, Markdown, Stories, Canvas } from "@storybook/blocks";
import * as SelectFieldStories from "./selectField.stories";
import * as RadioGroupStories from "./radioGroup.stories";
import Config from "./config.md?raw";

<Meta title="fields/selectField" of={SelectFieldStories} />

# `selectField<Value = string>(): ValidatedFieldAtom<Value | undefined>`

A generic choice field to hold a key of some options e.g. in `<input type="radio" />` or `<select />` elements.
The `undefined` empty value means that no option is selected.

```ts
import { selectField } from "@form-atoms/field";

// required string, must be filled to submit
const favoriteCategory = selectField();

// optional string, can be empty to submit
const companySize = selectField({ optional: true });
```

## Initial Config

<Markdown>{Config}</Markdown>

## Examples

### Number select

By default the select field works with `string` values. You can specify your own type. For example to make a rating field with choices 1-5
you will need a `numericSelectField`:

```ts
import { selectField } from "@form-atoms/field";
import { useFieldActions } from "form-atoms";

const rating = selectField<number>({ schema: z.number() });

const actions = useFieldActions(rating);

actions.setValue("4"); // ERR!
actions.setValue(4); // OK
```

## useSelectFieldProps(selectField)

A hook providing props to control a select or radio input.

## useSelectOptions(selectField, SelectProps)

A hook which transforms generic options into value/label pairs and computes `isActive` prop for each option based on the selectField value.

### Generic example with `<select />`

```tsx
const SelectInput = <Option,>({
  field,
  label,
  getValue,
  getLabel,
  options,
  placeholder,
}: SelectFieldProps<Option>) => {
  const props = useSelectFieldProps(field);

  const { renderOptions, placeholderOption } = useSelectOptions(field, {
    getValue,
    getLabel,
    options,
    placeholder,
  });

  return (
    <div style={{ margin: "20px 0" }}>
      <FieldLabel field={field} label={label} />
      <select {...props}>
        {placeholderOption}
        {renderOptions.map(({ value, label }) => (
          <option key={value} value={value}>
            {label}
          </option>
        ))}
      </select>
      <div>
        <FieldErrors field={field} />
      </div>
    </div>
  );
};

// options data have custom shape
const countryOptions = [
  { name: "Slovak Republic", key: "SK" },
  { name: "Czech Republic", key: "CZ" },
];

// provide value/label accessors
<SelectInput
  field={fields.country}
  label="Country of Origin"
  options={countryOptions}
  getValue={({ key }) => key}
  getLabel={({ name }) => name}
/>;
```

<Stories />

### Generic example with `<input type="radio" />`

```tsx
const RadioGroup = <Option,>({
  field,
  label,
  getValue,
  getLabel,
  options,
  placeholder,
}: SelectFieldProps<Option>) => {
  const props = useSelectFieldProps(field);

  const { renderOptions } = useSelectOptions(field, {
    getValue,
    getLabel,
    options,
    placeholder,
  });

  return (
    <div style={{ margin: "20px 0" }}>
      <FieldLabel field={field} label={label} />
      {renderOptions.map(({ id, value, label, isActive }) => (
        <div key={id}>
          <input
            {...props}
            type="radio"
            id={id}
            value={value}
            checked={isActive}
          />
          <label htmlFor={id}>{label}</label>
        </div>
      ))}
      <div>
        <FieldErrors field={field} />
      </div>
    </div>
  );
};

const bashAnswers = [
  { answer: "Bash, a Shell", key: "A" },
  { answer: "Bash Ain't Shell", key: "B" },
  { answer: "Bourne Again Shell", key: "C" },
  { answer: "Behold! Another Shell", key: "D" },
];

<RadioGroup
  field={fields.bash}
  label="Bash stands for ____?"
  options={bashAnswers}
  getValue={({ key }) => key}
  getLabel={({ answer }) => answer}
/>;
```

### Required

<Canvas of={RadioGroupStories.Required} />
